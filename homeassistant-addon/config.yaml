name: "C-Gate Web Bridge"
version: "1.2.0"
slug: cgateweb
description: "Bridge between Clipsal C-Bus systems and MQTT/Home Assistant"
url: "https://github.com/dougrathbone/cgateweb"
arch:
  - aarch64
  - amd64
  - armhf
  - armv7
  - i386

startup: application
boot: auto
init: false
host_network: true
ingress: true
ingress_port: 8080
panel_icon: "mdi:label-outline"
panel_title: "C-Bus Labels"

ports:
  "8080/tcp": 8080

ports_description:
  "8080/tcp": "C-Bus Label Editor web interface"

homeassistant_api: true

services:
  - mqtt:want

map:
  - "config:rw"
  - "share:ro"

options:
  # C-Gate mode
  cgate_mode: "remote"

  # C-Gate connection settings
  cgate_host: ""
  cgate_port: 20023
  cgate_event_port: 20025
  cgate_project: "HOME"

  # C-Gate managed mode settings
  cgate_install_source: "download"

  # C-Bus monitoring settings
  getall_networks:
    - 254
  getall_on_start: true
  getall_period: 3600

  # MQTT settings
  retain_reads: false
  message_interval: 200

  # Logging
  log_level: "info"

  # Home Assistant Discovery
  ha_discovery_enabled: true
  ha_discovery_prefix: "homeassistant"
  ha_discovery_networks:
    - 254
  ha_discovery_cover_app_id: 203

  # Label file for custom device names (auto-detected if not set)
  cbus_label_file: ""

schema:
  # C-Gate mode
  cgate_mode: "list(remote|managed)"

  # C-Gate connection settings
  cgate_host: "str"
  cgate_port: "int(1,65535)"
  cgate_event_port: "int(1,65535)"
  cgate_project: "str"

  # C-Gate managed mode settings
  cgate_install_source: "list(download|upload)"
  cgate_download_url: "str?"

  # MQTT settings (auto-detected from Mosquitto add-on)
  mqtt_host: "str?"
  mqtt_port: "int(1,65535)?"
  mqtt_username: "str?"
  mqtt_password: "password?"

  # C-Bus monitoring settings
  getall_networks: ["int(1,255)"]
  getall_on_start: "bool"
  getall_period: "int(60,86400)"

  # MQTT settings
  retain_reads: "bool"
  message_interval: "int(100,10000)"

  # Logging
  log_level: "list(debug|info|warn|error)"

  # Home Assistant Discovery
  ha_discovery_enabled: "bool"
  ha_discovery_prefix: "str"
  ha_discovery_networks: ["int(1,255)"]
  ha_discovery_cover_app_id: "int(1,255)?"
  ha_discovery_switch_app_id: "int(1,255)?"
  cbus_label_file: "str?"
